# terraform-init

Разворачиваем remote backend для хранения состояния terraform инфраструктуры на основе облаков (s3 + dynamodb).

Статья: https://ru.hexlet.io/courses/terraform-basics/lessons/remote-state/theory_unit

# ---

Что концептуально на вход должно попасть:
1. Название облака (оно уже создано)
2. Название каталога (его еще нет)
3. Регион
4. Access-токен для управления фолдером

Подразумевается, что эта конфигурается запускается один раз для разворачивания всего необходимого для разворачивания самой архитектуры

Что должен сделать этот конфиг:
1. Создать фолдер
2. Создать объекты s3, dynamodb, service account с нужными правами
3. Создать access-токен для сервисного аккаунта
4. Создать таблицу для лока конфигурации
5. *Создать сервисный аккаунт для управления инфраструктурой

На выходе:
1. Получаем access-key и secret для сервисного аккаута для управления состоянием
2. Получаем access-key и secret для накатывания инфры

*
Как безопаснее или удобнее:
1. Иметь sa с опасными доступами и с постоянным секретом
2. Постоянно вводить access-токен пользователя, который быстро тухнет, но имеет все необходимые права?

# Как запустить

Выписываем себе токен:
```
yc iam create-token
```

Кладем его в env'ы:
```
PS> $env:YC_TOKEN = 'your_token'
```

Запускаем terraform

```
terraform init
terraform get -update=true
terraform fmt
terraform validate
terraform plan -var-file .\tfvars\testing.tfvars
terraform apply -var-file .\tfvars\testing.tfvars
```
